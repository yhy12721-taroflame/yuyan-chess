# 象棋線上對戰 - 網頁版測試指南

## 概述

本指南說明如何使用網頁版測試頁面來測試象棋線上對戰功能。

## 快速開始

### 1. 啟動服務器

首先，啟動 WebSocket 服務器：

```bash
# 開發模式
npm run server:dev

# 或者編譯後運行
npm run server:build
npm run server
```

服務器將在 `ws://localhost:8080` 監聽。

### 2. 打開測試頁面

在瀏覽器中打開測試頁面：

```
http://localhost:8080/test.html
```

或者如果你有前端開發服務器運行：

```
http://localhost:3000/test.html
```

### 3. 測試基本連接

1. **輸入服務器地址**：確保地址是 `ws://localhost:8080`
2. **輸入玩家名稱**：例如 "測試玩家1"
3. **點擊「連接」按鈕**：建立 WebSocket 連接
4. **查看日誌**：應該看到 "已連接到服務器" 和 "已獲得玩家 ID" 的消息

## 測試場景

### 場景 1：單個玩家連接

1. 打開測試頁面
2. 輸入玩家名稱
3. 點擊「連接」
4. 觀察連接狀態和日誌

**預期結果**：
- 連接狀態顯示為 "已連接"（綠色）
- 日誌中顯示連接成功消息
- 玩家 ID 被分配並顯示

### 場景 2：創建房間

1. 連接到服務器
2. 點擊「創建房間」
3. 觀察房間信息

**預期結果**：
- 房間 ID 被生成
- 房間狀態顯示為 "等待中"
- 玩家數量顯示為 "1/2"

### 場景 3：加入房間

1. 打開兩個測試頁面（或兩個瀏覽器標籤）
2. 第一個頁面：創建房間，記下房間 ID
3. 第二個頁面：
   - 連接到服務器
   - 輸入房間 ID
   - 點擊「加入房間」

**預期結果**：
- 兩個玩家都在同一房間
- 房間狀態顯示為 "進行中"
- 玩家數量顯示為 "2/2"

### 場景 4：發送消息

1. 連接到服務器
2. 點擊「發送心跳」或「發送測試消息」
3. 觀察日誌和統計信息

**預期結果**：
- 消息被發送
- "已發送消息" 計數增加
- 日誌中顯示發送消息的記錄

### 場景 5：接收消息

1. 連接到服務器
2. 執行任何操作（如創建房間）
3. 觀察「最後接收的消息」區域

**預期結果**：
- 接收到服務器的響應消息
- "已接收消息" 計數增加
- 消息內容以 JSON 格式顯示

## 測試頁面功能說明

### 左側面板：連接和房間管理

- **連接狀態**：顯示當前的 WebSocket 連接狀態
- **服務器地址**：輸入 WebSocket 服務器的地址
- **玩家名稱**：輸入你的玩家名稱
- **連接/斷開按鈕**：管理與服務器的連接
- **房間 ID**：輸入要加入的房間 ID
- **創建房間/加入房間按鈕**：房間操作
- **房間信息**：顯示當前房間的詳細信息
- **玩家列表**：顯示房間中的所有玩家

### 右側面板：消息和日誌

- **統計信息**：
  - 已發送消息：發送的消息總數
  - 已接收消息：接收的消息總數
  - 隊列中的消息：等待發送的消息數
  - 連接時長：連接持續的時間

- **最後接收的消息**：顯示最後接收到的消息內容（JSON 格式）

- **日誌**：實時顯示所有操作和事件的日誌
  - 綠色：成功消息
  - 紅色：錯誤消息
  - 黃色：警告消息
  - 灰色：調試消息

### 測試操作按鈕

- **發送心跳**：發送心跳消息以保持連接活躍
- **發送測試消息**：發送一條測試消息
- **發送移動**：發送一個遊戲移動消息
- **請求遊戲狀態**：請求當前房間的遊戲狀態
- **請求房間列表**：請求所有可用房間的列表
- **模擬網絡延遲**：模擬 2 秒的網絡延遲

## 常見問題

### Q: 無法連接到服務器

**A**: 
1. 確保服務器已啟動：`npm run server:dev`
2. 確保服務器地址正確：`ws://localhost:8080`
3. 檢查防火牆設置
4. 查看瀏覽器控制台是否有錯誤信息

### Q: 連接後無法創建房間

**A**:
1. 確保已成功連接（連接狀態應為綠色）
2. 確保玩家名稱不為空
3. 查看日誌中是否有錯誤信息

### Q: 兩個玩家無法在同一房間

**A**:
1. 確保兩個玩家都已連接到服務器
2. 確保使用相同的房間 ID
3. 檢查房間是否已滿（2/2）
4. 查看日誌中的錯誤信息

### Q: 消息無法發送

**A**:
1. 確保已連接到服務器
2. 確保 WebSocket 連接狀態為 "已連接"
3. 查看瀏覽器控制台是否有錯誤信息
4. 檢查服務器日誌

## 調試技巧

### 1. 查看瀏覽器控制台

按 `F12` 打開開發者工具，查看控制台中的錯誤信息。

### 2. 查看服務器日誌

在終端中查看服務器的日誌輸出，了解服務器端發生的事情。

### 3. 使用日誌過濾

在日誌區域中，不同顏色的日誌表示不同的消息類型：
- 綠色：成功操作
- 紅色：錯誤
- 黃色：警告
- 灰色：調試信息

### 4. 監控統計信息

實時監控統計信息，了解消息的發送和接收情況。

### 5. 檢查最後接收的消息

查看最後接收的消息內容，確保服務器返回的數據格式正確。

## 測試清單

- [ ] 單個玩家可以連接到服務器
- [ ] 玩家可以創建房間
- [ ] 玩家可以加入房間
- [ ] 兩個玩家可以在同一房間
- [ ] 玩家可以發送消息
- [ ] 玩家可以接收消息
- [ ] 心跳消息正常工作
- [ ] 連接狀態正確顯示
- [ ] 日誌正確記錄所有操作
- [ ] 統計信息正確更新

## 下一步

完成基本測試後，你可以：

1. **實現更多消息類型**：在服務器中實現更多的消息處理邏輯
2. **添加遊戲邏輯**：實現實際的遊戲移動驗證和狀態管理
3. **優化性能**：測試高並發連接和消息吞吐量
4. **添加錯誤處理**：實現更完善的錯誤處理和恢復機制
5. **部署到生產環境**：將應用部署到實際的服務器

## 相關文檔

- [象棋線上對戰需求文檔](.kiro/specs/xiangqi-online/requirements.md)
- [象棋線上對戰設計文檔](.kiro/specs/xiangqi-online/design.md)
- [象棋線上對戰任務列表](.kiro/specs/xiangqi-online/tasks.md)
- [服務器部署指南](server/DEPLOYMENT_GUIDE.md)

## 支持

如有問題或建議，請查看相關文檔或聯繫開發團隊。
