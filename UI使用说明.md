# 象棋游戏 - 使用说明

## 项目概述

这是一个用纯 TypeScript 实现的中国象棋游戏引擎，包含完整的规则验证和 Web UI。

## 功能特性

✅ **完整的象棋规则实现**
- 所有 7 种棋子的移动规则
- 将帅对面检测
- 路径阻挡检测
- 合法移动生成

✅ **Web UI 界面**
- 基于 Canvas 的棋盘渲染
- 交叉点布局（符合象棋规则）
- 实时合法移动显示
- 玩家轮流提示
- 无效操作视觉反馈

✅ **完整的测试覆盖**
- 263 个单元测试和属性测试
- 28 个正确性属性验证

## 快速开始

### 1. 安装依赖
```bash
npm install
```

### 2. 运行开发服务器
```bash
npm run dev
```

然后在浏览器中打开 `http://localhost:8000`

### 3. 构建 UI
```bash
npm run build:ui
```

### 4. 运行测试
```bash
npm test
```

## 游戏操作

### 基本操作
1. **选择棋子**：点击你的棋子（红方或黑方）
2. **查看可移动位置**：选中棋子后，黄色圆点显示可移动的位置
3. **移动棋子**：点击黄色圆点移动棋子
4. **取消选择**：再次点击已选中的棋子可取消选择

### 视觉反馈
- **绿色高亮**：当前选中的棋子
- **黄色圆点**：可以移动到的合法位置
- **背景颜色**：
  - 红色背景：红方回合
  - 灰色背景：黑方回合
- **暗色覆盖**：点击无效位置时显示（会逐渐淡出）
- **当前玩家显示**：顶部显示当前是哪方的回合

### 棋子说明
| 棋子 | 红方 | 黑方 | 移动规则 |
|------|------|------|---------|
| 将/帅 | 帅 | 将 | 在九宫内移动一格（横或竖） |
| 士/仕 | 仕 | 士 | 在九宫内斜向移动一格 |
| 象/相 | 相 | 象 | 斜向移动两格，不过河，不能塞象眼 |
| 马 | 马 | 马 | 日字形移动，不能蹩马腿 |
| 车 | 车 | 车 | 直线移动，路径必须无阻挡 |
| 炮 | 炮 | 炮 | 直线移动，非吃子需无阻挡，吃子需要炮架 |
| 兵/卒 | 兵 | 卒 | 过河前只能前进，过河后可横向移动 |

## 项目结构

```
src/
├── core/
│   ├── Position.ts       # 位置类
│   ├── Piece.ts          # 棋子类
│   ├── Move.ts           # 移动类
│   ├── Board.ts          # 棋盘类
│   ├── MoveValidator.ts  # 移动验证器
│   └── types.ts          # 类型定义
└── app.ts                # Web UI 主文件

__tests__/
├── unit/                 # 单元测试
└── properties/           # 属性测试

public/
├── index.html            # HTML 页面
└── app.js                # 编译后的 JavaScript
```

## 开发命令

| 命令 | 说明 |
|------|------|
| `npm run build` | 编译 TypeScript |
| `npm run build:ui` | 构建 Web UI |
| `npm run dev` | 启动开发服务器（带热重载） |
| `npm test` | 运行所有测试 |
| `npm run test:watch` | 监视模式运行测试 |
| `npm run test:coverage` | 生成测试覆盖率报告 |
| `npm run demo` | 运行演示脚本 |

## 技术栈

- **语言**：TypeScript
- **测试框架**：Jest
- **属性测试**：fast-check
- **构建工具**：esbuild
- **UI**：HTML5 Canvas

## 测试覆盖

项目包含 263 个测试，覆盖：
- 基础数据结构（Position、Piece、Move、Board）
- 所有棋子的移动规则
- 特殊规则（将帅对面、路径检测等）
- 28 个正确性属性

所有测试都通过，确保游戏规则的正确性。

## 离线使用

该游戏完全离线运行，无需网络连接。所有资源都在本地加载。

## 许可证

MIT
