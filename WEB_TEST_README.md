# 象棋線上對戰 - 網頁版測試

## 📋 概述

這是一個完整的網頁版測試套件，用於測試象棋線上對戰功能。包括：

- **test.html** - 功能完整的測試頁面
- **TEST_GUIDE.md** - 詳細的測試指南
- **start-test.bat** - Windows 快速啟動腳本
- **start-test.ps1** - PowerShell 快速啟動腳本

## 🚀 快速開始

### 方式 1：使用啟動腳本（推薦）

#### Windows (CMD)
```bash
start-test.bat
```

#### Windows (PowerShell)
```powershell
.\start-test.ps1
```

#### macOS/Linux
```bash
npm run server:build
npm run server
# 然後在瀏覽器中打開 http://localhost:8080/test.html
```

### 方式 2：手動啟動

```bash
# 1. 編譯服務器
npm run server:build

# 2. 啟動服務器
npm run server

# 3. 在瀏覽器中打開
# http://localhost:8080/test.html
```

## 📖 測試頁面功能

### 左側面板：連接和房間管理

| 功能 | 說明 |
|------|------|
| 連接狀態 | 實時顯示 WebSocket 連接狀態 |
| 服務器地址 | 輸入 WebSocket 服務器地址 |
| 玩家名稱 | 輸入你的玩家名稱 |
| 連接/斷開 | 管理與服務器的連接 |
| 房間 ID | 輸入要加入的房間 ID |
| 創建房間 | 創建新的遊戲房間 |
| 加入房間 | 加入現有的遊戲房間 |
| 房間信息 | 顯示當前房間的詳細信息 |
| 玩家列表 | 顯示房間中的所有玩家 |

### 右側面板：消息和日誌

| 功能 | 說明 |
|------|------|
| 已發送消息 | 發送的消息總數 |
| 已接收消息 | 接收的消息總數 |
| 隊列中的消息 | 等待發送的消息數 |
| 連接時長 | 連接持續的時間 |
| 最後接收的消息 | 顯示最後接收到的消息內容 |
| 日誌 | 實時顯示所有操作和事件 |

### 測試操作按鈕

| 按鈕 | 功能 |
|------|------|
| 發送心跳 | 發送心跳消息以保持連接活躍 |
| 發送測試消息 | 發送一條測試消息 |
| 發送移動 | 發送一個遊戲移動消息 |
| 請求遊戲狀態 | 請求當前房間的遊戲狀態 |
| 請求房間列表 | 請求所有可用房間的列表 |
| 模擬網絡延遲 | 模擬 2 秒的網絡延遲 |

## 🧪 測試場景

### 場景 1：基本連接測試

1. 打開測試頁面
2. 輸入玩家名稱
3. 點擊「連接」
4. 驗證連接狀態變為綠色

**預期結果**：
- ✓ 連接狀態顯示為 "已連接"
- ✓ 玩家 ID 被分配
- ✓ 日誌顯示連接成功

### 場景 2：房間創建和加入

1. 玩家 A：連接 → 創建房間
2. 玩家 B：連接 → 輸入房間 ID → 加入房間
3. 驗證兩個玩家在同一房間

**預期結果**：
- ✓ 房間 ID 被生成
- ✓ 玩家數量顯示為 "2/2"
- ✓ 房間狀態顯示為 "進行中"

### 場景 3：消息發送和接收

1. 連接到服務器
2. 點擊「發送測試消息」
3. 驗證消息被發送和接收

**預期結果**：
- ✓ "已發送消息" 計數增加
- ✓ "已接收消息" 計數增加
- ✓ 最後接收的消息顯示服務器響應

### 場景 4：心跳機制

1. 連接到服務器
2. 點擊「發送心跳」
3. 驗證心跳消息被發送

**預期結果**：
- ✓ 日誌顯示心跳消息已發送
- ✓ 連接保持活躍

### 場景 5：多房間並發

1. 打開多個測試頁面
2. 每個頁面創建或加入不同的房間
3. 驗證房間之間的隔離

**預期結果**：
- ✓ 每個房間獨立運行
- ✓ 消息不會跨房間傳遞
- ✓ 玩家只能看到自己房間的信息

## 📊 日誌顏色說明

| 顏色 | 類型 | 說明 |
|------|------|------|
| 🟢 綠色 | 成功 | 操作成功完成 |
| 🔴 紅色 | 錯誤 | 發生錯誤 |
| 🟡 黃色 | 警告 | 警告信息 |
| ⚪ 灰色 | 調試 | 調試信息 |

## 🔧 故障排除

### 無法連接到服務器

**症狀**：連接按鈕點擊後無反應或顯示錯誤

**解決方案**：
1. 確保服務器已啟動：`npm run server`
2. 確保服務器地址正確：`ws://localhost:8080`
3. 檢查防火牆設置
4. 查看瀏覽器控制台（F12）是否有錯誤

### 無法創建房間

**症狀**：點擊「創建房間」後無反應

**解決方案**：
1. 確保已連接到服務器（連接狀態為綠色）
2. 確保玩家名稱不為空
3. 查看日誌中是否有錯誤信息
4. 檢查服務器日誌

### 兩個玩家無法在同一房間

**症狀**：玩家 B 加入房間後仍顯示 "1/2"

**解決方案**：
1. 確保兩個玩家都已連接
2. 確保使用相同的房間 ID
3. 刷新頁面重試
4. 查看日誌中的錯誤信息

### 消息無法發送

**症狀**：點擊發送按鈕後消息計數不增加

**解決方案**：
1. 確保已連接到服務器
2. 確保 WebSocket 連接狀態為 "已連接"
3. 查看瀏覽器控制台是否有錯誤
4. 檢查服務器是否正常運行

## 💡 調試技巧

### 1. 使用瀏覽器開發者工具

按 `F12` 打開開發者工具：
- **Console** 標籤：查看 JavaScript 錯誤
- **Network** 標籤：查看 WebSocket 連接
- **Application** 標籤：查看本地存儲

### 2. 監控服務器日誌

在服務器終端中查看實時日誌，了解服務器端發生的事情。

### 3. 使用日誌過濾

在日誌區域中，不同顏色表示不同的消息類型，便於快速定位問題。

### 4. 檢查統計信息

實時監控統計信息，了解消息的發送和接收情況。

### 5. 查看最後接收的消息

檢查最後接收的消息內容，確保服務器返回的數據格式正確。

## 📝 測試清單

使用以下清單確保所有功能都已測試：

- [ ] 單個玩家可以連接到服務器
- [ ] 玩家可以創建房間
- [ ] 玩家可以加入房間
- [ ] 兩個玩家可以在同一房間
- [ ] 玩家可以發送消息
- [ ] 玩家可以接收消息
- [ ] 心跳消息正常工作
- [ ] 連接狀態正確顯示
- [ ] 日誌正確記錄所有操作
- [ ] 統計信息正確更新
- [ ] 多房間並發正常工作
- [ ] 網絡延遲模擬正常工作
- [ ] 斷開連接後可以重新連接
- [ ] 消息隊列正常工作
- [ ] 錯誤消息正確顯示

## 🎯 下一步

完成基本測試後，你可以：

1. **實現更多消息類型**
   - 在服務器中實現更多的消息處理邏輯
   - 添加遊戲特定的消息類型

2. **添加遊戲邏輯**
   - 實現實際的遊戲移動驗證
   - 添加遊戲狀態管理
   - 實現遊戲結束檢測

3. **優化性能**
   - 測試高並發連接
   - 測試消息吞吐量
   - 優化內存使用

4. **添加錯誤處理**
   - 實現更完善的錯誤處理
   - 添加自動重連機制
   - 實現消息重試邏輯

5. **部署到生產環境**
   - 配置生產環境設置
   - 設置 SSL/TLS
   - 配置負載均衡

## 📚 相關文檔

- [象棋線上對戰需求文檔](.kiro/specs/xiangqi-online/requirements.md)
- [象棋線上對戰設計文檔](.kiro/specs/xiangqi-online/design.md)
- [象棋線上對戰任務列表](.kiro/specs/xiangqi-online/tasks.md)
- [詳細測試指南](TEST_GUIDE.md)
- [服務器部署指南](server/DEPLOYMENT_GUIDE.md)

## 🤝 支持

如有問題或建議，請：

1. 查看相關文檔
2. 檢查日誌和錯誤信息
3. 查看瀏覽器控制台
4. 聯繫開發團隊

## 📄 許可證

本項目遵循 ISC 許可證。

---

**最後更新**：2024 年

**版本**：1.0.0
